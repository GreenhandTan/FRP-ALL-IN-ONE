# FRP Manager Agent - Makefile
# ç”¨äºäº¤å‰ç¼–è¯‘å„å¹³å°ç‰ˆæœ¬

BINARY_NAME=frp-agent
VERSION=1.0.0
BUILD_TIME=$(shell date +%Y-%m-%d_%H:%M:%S)
LDFLAGS=-ldflags "-s -w -X main.version=$(VERSION) -X main.buildTime=$(BUILD_TIME)"

.PHONY: all clean linux-amd64 linux-arm64 darwin-amd64 darwin-arm64 windows-amd64 deps

# é»˜è®¤ç›®æ ‡ï¼šæ„å»ºæ‰€æœ‰å¹³å°
all: deps linux-amd64 linux-arm64 darwin-amd64 darwin-arm64 windows-amd64
	@echo "âœ… æ‰€æœ‰å¹³å°æ„å»ºå®Œæˆï¼Œäº§ç‰©åœ¨ dist/ ç›®å½•"
	@ls -la dist/

# ä¸‹è½½ä¾èµ–
deps:
	@echo "ğŸ“¦ ä¸‹è½½ä¾èµ–..."
	go mod tidy
	go mod download

# Linux AMD64 (æœ€å¸¸ç”¨)
linux-amd64:
	@echo "ğŸ”¨ æ„å»º Linux AMD64..."
	GOOS=linux GOARCH=amd64 go build $(LDFLAGS) -o dist/$(BINARY_NAME)-linux-amd64 ./cmd/frp-agent

# Linux ARM64 (æ ‘è“æ´¾, ARMæœåŠ¡å™¨)
linux-arm64:
	@echo "ğŸ”¨ æ„å»º Linux ARM64..."
	GOOS=linux GOARCH=arm64 go build $(LDFLAGS) -o dist/$(BINARY_NAME)-linux-arm64 ./cmd/frp-agent

# macOS Intel
darwin-amd64:
	@echo "ğŸ”¨ æ„å»º macOS AMD64..."
	GOOS=darwin GOARCH=amd64 go build $(LDFLAGS) -o dist/$(BINARY_NAME)-darwin-amd64 ./cmd/frp-agent

# macOS Apple Silicon
darwin-arm64:
	@echo "ğŸ”¨ æ„å»º macOS ARM64..."
	GOOS=darwin GOARCH=arm64 go build $(LDFLAGS) -o dist/$(BINARY_NAME)-darwin-arm64 ./cmd/frp-agent

# Windows
windows-amd64:
	@echo "ğŸ”¨ æ„å»º Windows AMD64..."
	GOOS=windows GOARCH=amd64 go build $(LDFLAGS) -o dist/$(BINARY_NAME)-windows-amd64.exe ./cmd/frp-agent

# ä»…æ„å»ºå½“å‰å¹³å°ï¼ˆå¼€å‘ç”¨ï¼‰
dev:
	@echo "ğŸ”¨ æ„å»ºå½“å‰å¹³å°..."
	go build $(LDFLAGS) -o dist/$(BINARY_NAME) ./cmd/frp-agent

# è¿è¡Œæµ‹è¯•
test:
	go test -v ./...

# æ¸…ç†
clean:
	rm -rf dist/
	@echo "ğŸ§¹ æ¸…ç†å®Œæˆ"

# å¸®åŠ©
help:
	@echo "FRP Manager Agent æ„å»ºè„šæœ¬"
	@echo ""
	@echo "ç›®æ ‡:"
	@echo "  all           - æ„å»ºæ‰€æœ‰å¹³å°"
	@echo "  dev           - ä»…æ„å»ºå½“å‰å¹³å°ï¼ˆå¼€å‘ç”¨ï¼‰"
	@echo "  linux-amd64   - æ„å»º Linux AMD64"
	@echo "  linux-arm64   - æ„å»º Linux ARM64"
	@echo "  darwin-amd64  - æ„å»º macOS Intel"
	@echo "  darwin-arm64  - æ„å»º macOS Apple Silicon"
	@echo "  windows-amd64 - æ„å»º Windows"
	@echo "  clean         - æ¸…ç†æ„å»ºäº§ç‰©"
	@echo ""
	@echo "ç¤ºä¾‹:"
	@echo "  make all      - æ„å»ºæ‰€æœ‰å¹³å°"
	@echo "  make dev      - å¿«é€Ÿæ„å»ºå½“å‰å¹³å°è¿›è¡Œæµ‹è¯•"
